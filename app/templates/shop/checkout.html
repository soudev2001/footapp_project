{% extends "base.html" %}
{% block title %}Réservation Finale - FootLogic Elite{% endblock %}

{% block content %}
<div class="page-enter max-w-4xl mx-auto px-4 py-8">
    <div class="mb-12">
        <h1 class="text-4xl font-bold uppercase tracking-tighter">PHASE <span
                class="text-gradient">FINALE</span></h1>
        <p class="text-white/40 text-sm mt-1">Validez votre réservation et récupérez vos articles au club.</p>
    </div>

    <form action="{{ url_for('main.checkout') }}" method="POST" onsubmit="return handleCheckout(event)"
        class="grid md:grid-cols-5 gap-12">

        <!-- Form -->
        <div class="md:col-span-3 space-y-8">
            <div class="glass p-10 rounded-3xl border-white/5 space-y-8">
                <h3 class="text-xs font-bold uppercase tracking-wider text-primary-400 mb-4">Informations de
                    retrait</h3>

                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label
                            class="text-[10px] font-bold uppercase tracking-wider text-white/20 mb-3 ml-1 block">Prénom</label>
                        <input type="text" name="first_name"
                            value="{{ current_user.profile.first_name if current_user }}" required
                            class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white font-bold">
                    </div>
                    <div>
                        <label
                            class="text-[10px] font-bold uppercase tracking-wider text-white/20 mb-3 ml-1 block">Nom</label>
                        <input type="text" name="last_name" value="{{ current_user.profile.last_name if current_user }}"
                            required
                            class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white font-bold">
                    </div>
                </div>

                <div>
                    <label
                        class="text-[10px] font-bold uppercase tracking-wider text-white/20 mb-3 ml-1 block">Email</label>
                    <input type="email" name="email" value="{{ current_user.email if current_user }}" required
                        class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white font-bold">
                </div>

                <div>
                    <label class="text-[10px] font-bold uppercase tracking-wider text-white/20 mb-3 ml-1 block">Date
                        de retrait souhaitée</label>
                    <select name="pickup_date" required
                        class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white font-bold appearance-none cursor-pointer">
                        <option value="next_training" class="bg-surface-950">Prochain Entraînement (Mardi)</option>
                        <option value="next_match" class="bg-surface-950">Jour de Match (Samedi)</option>
                        <option value="admin_office" class="bg-surface-950">Bureaux du Club (Lundi-Vendredi)</option>
                    </select>
                </div>
            </div>

            <div class="bg-primary-500/5 border border-primary-500/20 p-8 rounded-3xl flex items-start gap-6">
                <div
                    class="w-12 h-12 rounded-2xl bg-primary-500 flex items-center justify-center text-white flex-shrink-0 shadow-lg shadow-primary-500/20">
                    <i class="fa-solid fa-hand-holding-dollar text-xl"></i>
                </div>
                <div>
                    <h4 class="font-bold uppercase text-sm mb-1">Paiement au Retrait</h4>
                    <p class="text-xs text-white/40 font-medium">Pour faciliter la gestion du club, le paiement
                        s'effectue directement au stade par CB ou Espèces lors de la remise des articles.</p>
                </div>
            </div>
        </div>

        <!-- Summary -->
        <div class="md:col-span-2 space-y-6">
            <div class="glass p-8 rounded-3xl border-white/5">
                <h3 class="text-xs font-bold uppercase tracking-wider text-white/20 mb-8 text-center">Votre
                    Commande</h3>

                <div id="checkoutItems" class="space-y-4 mb-10">
                    <!-- Dynamic items here -->
                </div>

                <div class="pt-8 border-t border-white/5 space-y-4">
                    <div class="flex justify-between items-center text-xs font-bold uppercase">
                        <span class="text-white/40">Total à régler</span>
                        <span id="checkoutTotal" class="text-2xl text-gradient">0.00€</span>
                    </div>
                </div>
            </div>

            <button type="submit"
                class="w-full gradient-primary py-6 rounded-2xl text-xs font-bold uppercase tracking-[0.2em] shadow-2xl shadow-primary-500/30 hover:scale-[1.02] active:scale-95 transition-all outline-none">
                RÉSERVER MAINTENANT
            </button>
            <p class="text-[9px] text-center text-white/20 font-bold uppercase tracking-wider px-4 leading-relaxed">
                En cliquant sur "Réserver", vous vous engagez à venir retirer et régler vos articles au club.
            </p>
        </div>
    </form>
</div>

<script>
    function renderCheckout() {
        const cart = JSON.parse(localStorage.getItem('footlogic_cart') || '[]');
        const container = document.getElementById('checkoutItems');
        let total = 0;

        if (cart.length === 0) {
            window.location.href = "{{ url_for('main.shop_catalog') }}";
            return;
        }

        container.innerHTML = '';
        cart.forEach(item => {
            const div = document.createElement('div');
            div.className = 'flex justify-between items-center bg-white/5 p-4 rounded-2xl border border-white/5';
            div.innerHTML = `
                <div class="flex items-center gap-3">
                    <span class="w-8 h-8 rounded-lg gradient-primary flex items-center justify-center text-[10px] font-bold">${item.quantity}</span>
                    <div class="flex flex-col">
                        <span class="text-[10px] font-bold uppercase">${item.name}</span>
                        <span class="text-[8px] text-white/20 font-bold uppercase">${item.size || 'Unique'}</span>
                    </div>
                </div>
                <span class="text-xs font-bold">${(item.price * item.quantity).toFixed(2)}€</span>
            `;
            container.appendChild(div);
            total += item.price * item.quantity;
        });

        document.getElementById('checkoutTotal').innerText = total.toFixed(2) + '€';
    }

    function handleCheckout(e) {
        // Clear cart local storage on success simulation
        localStorage.removeItem('footlogic_cart');
        return true;
    }

    document.addEventListener('DOMContentLoaded', renderCheckout);
</script>
{% endblock %}