{% extends "base.html" %}
{% block title %}Mon Panier - FootLogic Elite{% endblock %}

{% block content %}
<div class="page-enter max-w-5xl mx-auto px-4 py-8">
    <div class="flex items-center justify-between mb-12">
        <h1 class="text-4xl font-bold uppercase tracking-tighter">MON <span class="text-gradient">PANIER</span>
        </h1>
        <a href="{{ url_for('main.shop_catalog') }}"
            class="text-[10px] font-bold uppercase tracking-wider text-white/40 hover:text-white transition-colors">
            <i class="fa-solid fa-arrow-left mr-2"></i> Continuer les achats
        </a>
    </div>

    <div id="cartEmpty" class="hidden glass p-20 rounded-3xl border-white/5 text-center">
        <div
            class="w-24 h-24 bg-white/5 rounded-2xl flex items-center justify-center mx-auto mb-8 border border-white/10">
            <i class="fa-solid fa-cart-arrow-down text-white/10 text-4xl"></i>
        </div>
        <h2 class="text-2xl font-bold uppercase mb-2">Votre panier est vide</h2>
        <p class="text-white/20 text-sm mb-10">C'est le moment idéal pour découvrir notre nouvelle collection.
        </p>
        <a href="{{ url_for('main.shop_catalog') }}"
            class="gradient-primary px-12 py-5 rounded-2xl text-[10px] font-bold uppercase tracking-wider shadow-xl shadow-primary-500/20">VOIR
            LA BOUTIQUE</a>
    </div>

    <div id="cartContent" class="grid lg:grid-cols-3 gap-12">
        <!-- List -->
        <div class="lg:col-span-2 space-y-6" id="cartItems">
            <!-- Dynamic items here -->
        </div>

        <!-- Summary -->
        <div class="lg:col-span-1">
            <div class="glass p-10 rounded-3xl border-white/5 sticky top-24">
                <h3 class="text-xs font-bold uppercase tracking-wider text-primary-400 mb-8">Récapitulatif</h3>

                <div class="space-y-6 mb-10 pb-10 border-b border-white/5">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-bold text-white/40 uppercase">Sous-total</span>
                        <span id="subtotal" class="font-bold text-lg">0.00€</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-bold text-white/40 uppercase">Livraison (Stade)</span>
                        <span class="text-xs font-bold text-green-400 uppercase">OFFERT</span>
                    </div>
                </div>

                <div class="flex justify-between items-center mb-10">
                    <span class="text-sm font-bold uppercase">TOTAL TTC</span>
                    <span id="total" class="text-3xl font-bold text-gradient tracking-tighter">0.00€</span>
                </div>

                <a href="{{ url_for('main.checkout') }}"
                    class="w-full gradient-primary py-6 rounded-[24px] text-xs font-bold uppercase tracking-wider shadow-2xl shadow-primary-500/30 flex items-center justify-center hover:scale-[1.02] active:scale-95 transition-all outline-none">
                    PASSER À LA RÉSERVATION
                </a>
            </div>
        </div>
    </div>
</div>

<template id="cartItemTemplate">
    <div class="glass p-8 rounded-3xl border-white/5 flex gap-8 items-center group relative overflow-hidden">
        <div
            class="absolute inset-0 bg-primary-500/5 translate-x-full group-hover:translate-x-0 transition-transform duration-700">
        </div>
        <div class="w-24 h-24 rounded-2xl overflow-hidden flex-shrink-0 z-10 border border-white/10">
            <img src="" alt="" class="w-full h-full object-cover item-img">
        </div>
        <div class="flex-1 z-10">
            <div class="flex items-start justify-between">
                <div>
                    <h4 class="font-bold uppercase text-lg item-name">Product Name</h4>
                    <p class="text-[10px] font-bold uppercase tracking-wider text-white/20 mt-1">Taille: <span
                            class="item-size">-</span></p>
                </div>
                <p class="text-lg font-bold item-price">0.00€</p>
            </div>
            <div class="flex items-center justify-between mt-6">
                <div class="flex items-center gap-4 bg-white/5 rounded-xl p-1.5 border border-white/10">
                    <button
                        class="w-8 h-8 flex items-center justify-center text-white/40 hover:text-white transition-colors item-minus"><i
                            class="fa-solid fa-minus"></i></button>
                    <span class="w-6 text-center font-bold text-xs item-qty">1</span>
                    <button
                        class="w-8 h-8 flex items-center justify-center text-white/40 hover:text-white transition-colors item-plus"><i
                            class="fa-solid fa-plus"></i></button>
                </div>
                <button
                    class="text-[10px] font-bold uppercase tracking-wider text-red-400/50 hover:text-red-400 transition-colors item-remove">Supprimer</button>
            </div>
        </div>
    </div>
</template>

<script>
    function renderCart() {
        const cart = JSON.parse(localStorage.getItem('footlogic_cart') || '[]');
        const container = document.getElementById('cartItems');
        const emptyView = document.getElementById('cartEmpty');
        const contentView = document.getElementById('cartContent');
        const template = document.getElementById('cartItemTemplate');

        if (cart.length === 0) {
            emptyView.classList.remove('hidden');
            contentView.classList.add('hidden');
            return;
        }

        emptyView.classList.add('hidden');
        contentView.classList.remove('hidden');
        container.innerHTML = '';

        let total = 0;

        cart.forEach((item, index) => {
            const clone = template.content.cloneNode(true);
            clone.querySelector('.item-img').src = item.image;
            clone.querySelector('.item-name').innerText = item.name;
            clone.querySelector('.item-price').innerText = (item.price * item.quantity).toFixed(2) + '€';
            clone.querySelector('.item-size').innerText = item.size || 'Unique';
            clone.querySelector('.item-qty').innerText = item.quantity;

            clone.querySelector('.item-minus').onclick = () => updateQty(index, -1);
            clone.querySelector('.item-plus').onclick = () => updateQty(index, 1);
            clone.querySelector('.item-remove').onclick = () => removeItem(index);

            container.appendChild(clone);
            total += item.price * item.quantity;
        });

        document.getElementById('subtotal').innerText = total.toFixed(2) + '€';
        document.getElementById('total').innerText = total.toFixed(2) + '€';
    }

    function updateQty(index, delta) {
        let cart = JSON.parse(localStorage.getItem('footlogic_cart') || '[]');
        cart[index].quantity = Math.max(1, cart[index].quantity + delta);
        localStorage.setItem('footlogic_cart', JSON.stringify(cart));
        renderCart();
    }

    function removeItem(index) {
        let cart = JSON.parse(localStorage.getItem('footlogic_cart') || '[]');
        cart.splice(index, 1);
        localStorage.setItem('footlogic_cart', JSON.stringify(cart));
        renderCart();
    }

    document.addEventListener('DOMContentLoaded', renderCart);
</script>
{% endblock %}