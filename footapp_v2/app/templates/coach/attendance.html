{% extends "base.html" %}
{% block title %}Feuille de Présence - FootApp{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 py-6">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-bold">Feuille de Présence</h1>
            <p class="text-gray-400 text-sm">Entraînement • Sam 8 Février</p>
        </div>
        <div class="text-right">
            <span class="block text-3xl font-black text-primary-400" id="presentCount">0/14</span>
            <span class="text-[10px] font-bold text-gray-500 uppercase">Présents</span>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="flex gap-2 mb-6">
        <button onclick="markAll('present')"
            class="flex-1 glass-light py-2.5 rounded-xl text-sm font-bold hover:bg-green-500/20 hover:text-green-400 transition flex items-center justify-center gap-2">
            <i class="fa-solid fa-check-double"></i>
            Tous présents
        </button>
        <button onclick="markAll('absent')"
            class="flex-1 glass-light py-2.5 rounded-xl text-sm font-bold hover:bg-red-500/20 hover:text-red-400 transition flex items-center justify-center gap-2">
            <i class="fa-solid fa-xmark"></i>
            Réinitialiser
        </button>
    </div>

    <!-- Legend -->
    <div class="flex gap-4 mb-6 text-xs">
        <span class="flex items-center gap-1.5"><span class="w-3 h-3 rounded-full bg-green-500"></span> Présent</span>
        <span class="flex items-center gap-1.5"><span class="w-3 h-3 rounded-full bg-amber-500"></span> Retard</span>
        <span class="flex items-center gap-1.5"><span class="w-3 h-3 rounded-full bg-red-500"></span> Absent</span>
        <span class="flex items-center gap-1.5"><span class="w-3 h-3 rounded-full bg-gray-500"></span> Blessé</span>
    </div>

    <!-- Player List -->
    <div class="space-y-3" id="playerList">
        {% for player in players %}
        <div class="card p-4 flex items-center justify-between" data-player-id="{{ player.id }}">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-full overflow-hidden">
                    <img src="https://randomuser.me/api/portraits/men/{{ loop.index + 10}}.jpg"
                        class="w-full h-full object-cover">
                </div>
                <div>
                    <p class="font-bold">{{ player.name }}</p>
                    <p class="text-xs text-gray-400">{{ player.position }}</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button class="status-btn present" onclick="setStatus(this, 'present')">
                    <i class="fa-solid fa-check"></i>
                </button>
                <button class="status-btn late" onclick="setStatus(this, 'late')">
                    <i class="fa-solid fa-clock"></i>
                </button>
                <button class="status-btn absent" onclick="setStatus(this, 'absent')">
                    <i class="fa-solid fa-xmark"></i>
                </button>
                <button class="status-btn injured" onclick="setStatus(this, 'injured')">
                    <i class="fa-solid fa-user-injured"></i>
                </button>
            </div>
        </div>
        {% else %}
        <!-- Demo players -->
        <div class="card p-4 flex items-center justify-between" data-player-id="1">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-full overflow-hidden">
                    <img src="https://randomuser.me/api/portraits/men/32.jpg" class="w-full h-full object-cover">
                </div>
                <div>
                    <p class="font-bold">Pierre Dubois</p>
                    <p class="text-xs text-gray-400">Attaquant • #9</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button class="status-btn present" onclick="setStatus(this, 'present')"><i
                        class="fa-solid fa-check"></i></button>
                <button class="status-btn late" onclick="setStatus(this, 'late')"><i
                        class="fa-solid fa-clock"></i></button>
                <button class="status-btn absent" onclick="setStatus(this, 'absent')"><i
                        class="fa-solid fa-xmark"></i></button>
                <button class="status-btn injured" onclick="setStatus(this, 'injured')"><i
                        class="fa-solid fa-user-injured"></i></button>
            </div>
        </div>
        <div class="card p-4 flex items-center justify-between" data-player-id="2">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-full overflow-hidden">
                    <img src="https://randomuser.me/api/portraits/men/22.jpg" class="w-full h-full object-cover">
                </div>
                <div>
                    <p class="font-bold">Romain Lambert</p>
                    <p class="text-xs text-gray-400">Milieu • #10</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button class="status-btn present" onclick="setStatus(this, 'present')"><i
                        class="fa-solid fa-check"></i></button>
                <button class="status-btn late" onclick="setStatus(this, 'late')"><i
                        class="fa-solid fa-clock"></i></button>
                <button class="status-btn absent" onclick="setStatus(this, 'absent')"><i
                        class="fa-solid fa-xmark"></i></button>
                <button class="status-btn injured" onclick="setStatus(this, 'injured')"><i
                        class="fa-solid fa-user-injured"></i></button>
            </div>
        </div>
        <div class="card p-4 flex items-center justify-between" data-player-id="3">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-full overflow-hidden">
                    <img src="https://randomuser.me/api/portraits/men/45.jpg" class="w-full h-full object-cover">
                </div>
                <div>
                    <p class="font-bold">Olivier Laurent</p>
                    <p class="text-xs text-gray-400">Défenseur • #4</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button class="status-btn present" onclick="setStatus(this, 'present')"><i
                        class="fa-solid fa-check"></i></button>
                <button class="status-btn late" onclick="setStatus(this, 'late')"><i
                        class="fa-solid fa-clock"></i></button>
                <button class="status-btn absent" onclick="setStatus(this, 'absent')"><i
                        class="fa-solid fa-xmark"></i></button>
                <button class="status-btn injured" onclick="setStatus(this, 'injured')"><i
                        class="fa-solid fa-user-injured"></i></button>
            </div>
        </div>
        <div class="card p-4 flex items-center justify-between" data-player-id="4">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-full overflow-hidden">
                    <img src="https://randomuser.me/api/portraits/men/19.jpg" class="w-full h-full object-cover">
                </div>
                <div>
                    <p class="font-bold">Marc Petit</p>
                    <p class="text-xs text-gray-400">Gardien • #1</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button class="status-btn present" onclick="setStatus(this, 'present')"><i
                        class="fa-solid fa-check"></i></button>
                <button class="status-btn late" onclick="setStatus(this, 'late')"><i
                        class="fa-solid fa-clock"></i></button>
                <button class="status-btn absent" onclick="setStatus(this, 'absent')"><i
                        class="fa-solid fa-xmark"></i></button>
                <button class="status-btn injured" onclick="setStatus(this, 'injured')"><i
                        class="fa-solid fa-user-injured"></i></button>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Save Button -->
    <div class="sticky bottom-20 md:bottom-4 mt-6">
        <button onclick="saveAttendance()" id="saveBtn"
            class="w-full btn-primary py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2">
            <i class="fa-solid fa-check-circle"></i>
            Valider la feuille
        </button>
    </div>
</div>

<style>
    .status-btn {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #6b7280;
        transition: all 0.2s;
        cursor: pointer;
    }

    .status-btn:hover {
        transform: scale(1.1);
    }

    .status-btn.active {
        transform: scale(1.1);
        border-color: transparent;
        color: white;
        box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.3);
    }

    .status-btn.present.active {
        background: linear-gradient(135deg, #10b981, #059669);
    }

    .status-btn.absent.active {
        background: linear-gradient(135deg, #ef4444, #dc2626);
    }

    .status-btn.late.active {
        background: linear-gradient(135deg, #f59e0b, #d97706);
    }

    .status-btn.injured.active {
        background: linear-gradient(135deg, #6b7280, #4b5563);
    }
</style>

<script>
    const totalPlayers = document.querySelectorAll('[data-player-id]').length;

    function setStatus(btn, status) {
        const parent = btn.parentElement;
        parent.querySelectorAll('.status-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        updateCounter();
    }

    function markAll(status) {
        document.querySelectorAll('.status-btn.' + status).forEach(btn => {
            const parent = btn.parentElement;
            parent.querySelectorAll('.status-btn').forEach(b => b.classList.remove('active'));
            if (status !== 'absent') btn.classList.add('active');
        });
        updateCounter();
    }

    function updateCounter() {
        const presents = document.querySelectorAll('.status-btn.present.active').length;
        const lates = document.querySelectorAll('.status-btn.late.active').length;
        document.getElementById('presentCount').innerText = `${presents + lates}/${totalPlayers}`;
    }

    function saveAttendance() {
        const btn = document.getElementById('saveBtn');
        const originalHTML = btn.innerHTML;

        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Enregistrement...';
        btn.disabled = true;

        setTimeout(() => {
            btn.innerHTML = '<i class="fa-solid fa-check"></i> Enregistré !';
            btn.classList.remove('gradient-primary');
            btn.classList.add('bg-green-500');

            setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.classList.add('gradient-primary');
                btn.classList.remove('bg-green-500');
                btn.disabled = false;
            }, 1500);
        }, 800);
    }

    // Initialize counter
    updateCounter();
</script>
{% endblock %}